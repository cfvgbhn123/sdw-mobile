!function(t){function e(n){if(i[n])return i[n].exports;var o=i[n]={i:n,l:!1,exports:{}};return t[n].call(o.exports,o,o.exports,e),o.l=!0,o.exports}var i={};return e.m=t,e.c=i,e.i=function(t){return t},e.d=function(t,i,n){e.o(t,i)||Object.defineProperty(t,i,{configurable:!1,enumerable:!0,get:n})},e.n=function(t){var i=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(i,"a",i),i},e.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},e.p="",e(e.s=1)}([function(t,e){},function(t,e,i){function n(t){function e(){n++,n==i&&(f.egg.init=!0,dialog.hidden(),t&&t())}dialog.show("loading","初始化...");var i=20,n=0,o=["yellow","blue","green","red"];o.forEach(function(t){for(var i=1;i<6;i++){var n=new Image;n.src=d+"images/egg-"+t+"-"+i+".png",n.onload=e}})}function o(t){function e(){o++,o==n&&(f.lottery.init=!0,dialog.hidden(),t&&t())}dialog.show("loading","初始化...");var i=["blue-node","cl-bottom","cl-left","cl-right","lottery-border-1","lottery-border-2","red-node","lottery-btn-bottom","lottery-btn-click","lottery-btn-light","lottery-btn-normal","line-blue","line-red"],n=i.length+16,o=0;i.forEach(function(t){for(var i=1;i<16;i++){var n=new Image;n.src=d+"images/"+t+".png",n.onload=e}});for(var s=1;s<16;s++){var r=new Image;r.src=d+"images/light"+s+".png",r.onload=e}}function s(t){this.id=t.id||"undefined",this.scroll_width=.86*document.documentElement.clientWidth>>0,this.current_scroll_width=0,this.current_index=0,this.textArry=t.texts||[],this.isLoop=t.isLoop||!0,this.text_dom_width=0,this.delTime=t.delTime||1e3}function r(t,e){var i=e-t+1;return Math.random()*i+t>>0}function a(){var t="182****";return t+=r(100,999)}function l(t){for(var e=[],i=0;i<t;i++){var n=a(),o=g[r(0,g.length-1)];e.push("玩家 "+n+"，兑换了"+o)}return e}function c(t,e,i){for(e=e||5,t=t||[],i=i||t.length;e--;)t=t.sort(function(){return Math.random()-.5});return t.slice(0,i)}function u(){var t=l(30);return c(t,3)}i(0);var d="https://www.shandw.com/mobile/shop/";!function(){for(var t=0,e=["ms","moz","webkit","o"],i=0;i<e.length&&!window.requestAnimationFrame;++i)window.requestAnimationFrame=window[e[i]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[e[i]+"CancelAnimationFrame"]||window[e[i]+"CancelRequestAnimationFrame"];window.requestAnimationFrame||(window.requestAnimationFrame=function(e,i){var n=(new Date).getTime(),o=Math.max(0,16-(n-t)),s=window.setTimeout(function(){e(n+o)},o);return t=n+o,s}),window.cancelAnimationFrame||(window.cancelAnimationFrame=function(t){clearTimeout(t)})}();var h={tipWindow:!1,coinTipWindow:!1,taskInfo:{code:"",show:0,info:""},user:{avatar:SDW_WEB.USER_INFO.avatar,id:SDW_WEB.USER_INFO.id,nick:SDW_WEB.USER_INFO.nick,gold:0,stamp:0,luckyDrawCost:0,luckyEggCost:0},egg:{init:!1,timer:null,show:0,egg:[{type:"yellow",state:1,cz:0},{type:"red",state:1,cz:0},{type:"blue",state:1,cz:0},{type:"green",state:1,cz:0}],result:{show:0,money:0},cz:0,request:0,rule:0,pos:1},lottery:{init:!1,show:0,timer:null,stateIndex:0,items:null,startTime:+new Date,stamp:0,lottery:[],result:{show:0},btnState:"normal",aniObj:{time:0,stop:0,aniTime:100,canplay:1}},lists:[]},m={gotoMyexcPage:function(){var t=SDW_WEB.MOBILE_ROOT+"myexc/?channel="+SDW_WEB.channel;SDW_WEB.openNewWindow({link:t,isFullScreen:!1,showMoreBtn:!1,title:"我的兑换记录"})},gotoAppMain:function(){SDW_WEB.onShandw?SDW_WEB.sdw.closeWindow():location.href=SDW_WEB.MOBILE_ROOT+"task/?channel="+SDW_WEB.channel},showCode:function(){prompt("您的兑换码",this.lottery.result.code)},transCoins:function(t){if(t<1e4)return t;if(t<1e8){var e=t/1e4>>0,i=t%1e4+"";return e+"."+i[0]+"万"}if(t<1e10){var e=t/1e8>>0,i=t%1e8+"";return e+"."+i[0]+"亿"}},loadList:function(){var t=this,e=SDW_WEB.URLS.addParam({channel:SDW_WEB.channel,token:SDW_WEB.USER_INFO.token,uid:SDW_WEB.USER_INFO.uid,sec:SDW_WEB.USER_INFO.secheme},!1,HTTP_STATIC+"shop");SDW_WEB.getAjaxData(e,function(e){if(1==e.result){var i=f.lists.concat(e.list);f.lists=i,f.user.gold=e.gold,f.user.stamp=e.stamp||0,f.user.luckyDrawCost=e.luckyDrawCost,f.user.luckyEggCost=e.luckyEggCost;var n=[];if(e.uilist.length){for(var o={},r=0;r<e.ulist.length;r++)o[e.ulist[r].id]||(o[e.ulist[r].id]=e.ulist[r].nick);for(var r=0;r<e.uilist.length;r++)n.push("玩家 "+(o[e.uilist[r].uid]||e.uilist[r].uid)+"，兑换了"+e.uilist[r].name)}else n=u();var a=new s({id:"cbd",texts:n});a.init(),t.lottery.lottery=e.luckyDrawItem}else dialog.show("error",e.msg,1)})},gotoPage:function(t){this.tipWindow=0,this.openGame(t)},click:function(t,e){var i=this.checkPayState(t),n=this;if(1==i){dialog.show("loading","兑换中...");var o=SDW_WEB.URLS.addParam({channel:SDW_WEB.channel,uid:SDW_WEB.USER_INFO.uid,token:SDW_WEB.USER_INFO.token,sec:SDW_WEB.USER_INFO.secheme,id:t.id,num:1},!1,HTTP_STATIC+"shopping");SDW_WEB.getAjaxData(o,function(e){if(1==e.result){3==t.pType&&(f.user.stamp-=t.gold),t.buy++,t.sell++,e.code?(dialog.hidden(),n.taskInfo.show=1,n.taskInfo.code=e.code,n.taskInfo.info=t.info):dialog.show("ok",e.msg,1)}})}else 3==i&&(n.tipWindow=!0)},checkPayState:function(t){if(t.count>=0&&t.count-t.sell<=0)return"该物品已经兑完";if(t.limit>=0&&t.limit<=t.buy)return"购买次数达到上限";switch(t.pType){case 1:return this.user.gold>=t.gold||"您的金币不足";case 2:case 3:return this.user.stamp>=t.gold||3;case 4:}},closePage:function(t,e){"result"==t?(this.lottery.result.show=0,this.egg.result.show=0,this.closePage("games",e),clearInterval(this.egg.timer)):"games"==t&&(this.egg.show=0,this.lottery.show=0,this.egg.rule=0),this.egg.pos=1},initEgg:function(){var t=this;if(this.egg.init){this.egg.result.show=0,this.egg.cz=0,this.egg.request=0,this.egg.timer=null,this.egg.pos=1,this.egg.egg.forEach(function(t){t.state=1});var e=document.querySelector("#egg-cz");e.className="egg-cz-0",setTimeout(function(){f.egg.pos=0},20),this.egg.show=1}else n(function(){t.initEgg()})},eggAnimation:function(t){t.state=2,f.egg.timer=setInterval(function(){5==t.state?t.state=4:t.state++},220)},openGame:function(t){"egg"==t&&this.initEgg(),"lottery"==t&&this.initLotteryFn()},scale:function(t,e){e.target.style.opacity=t},eggFn:function(t,e,i){if(!this.egg.request){if(this.user.gold<this.user.luckyEggCost)return void(this.coinTipWindow=1);var n=this;this.egg.cz=e;var o=document.querySelector("#egg-cz");o.className="egg-cz-"+e,setTimeout(function(){f.eggAnimation(t)},450),this.egg.request=1,setTimeout(function(){var t=SDW_WEB.URLS.addParam({channel:SDW_WEB.channel,token:SDW_WEB.USER_INFO.token,uid:SDW_WEB.USER_INFO.uid,sec:SDW_WEB.USER_INFO.secheme},!1,HTTP_STATIC+"luckyegg");SDW_WEB.getAjaxData(t,function(t){1==t.result?(f.egg.result.money=t.stamps+"点券",f.egg.result.show=1,f.user.gold-=n.user.luckyEggCost,f.user.stamp+=t.stamps):dialog.show("error",t.msg,1)})},1200)}},initLotteryFn:function(){var t=this,e=this.lottery;if(e.init){e.btnState="normal",e.stateIndex=0;var i=Math.max(0,40),n=/^\+?[1-9][0-9]*$/.test(i/8+"")?i/8:i/8+1;e.aniObj.time=8*n,e.aniObj.stop=0,e.aniObj.aniTime=100,e.aniObj.canplay=1,!e.items&&(e.items=document.querySelectorAll(".lottery-items"));var s=document.querySelector(".lottery-items-select");s&&s.classList.remove("lottery-items-select"),setTimeout(function(){e.show=1},100)}else o(function(){t.initLotteryFn()})},lotteryBtnClick:function(t,e){var i=this;if("light"!=this.lottery.btnState&&(this.lottery.btnState=t,"light"==t)){if(this.user.gold<this.user.luckyDrawCost)return e.stopPropagation(),i.lottery.btnState="normal",void setTimeout(function(){i.coinTipWindow=1},100);var n=SDW_WEB.URLS.addParam({channel:SDW_WEB.channel,token:SDW_WEB.USER_INFO.token,uid:SDW_WEB.USER_INFO.uid,sec:SDW_WEB.USER_INFO.secheme},!1,HTTP_STATIC+"luckydraw");SDW_WEB.getAjaxData(n,function(t){if(1==t.result){i.lottery.aniObj.stop=t.index-1;var e=i.lottery.lottery[t.index-1];i.lottery.result.icon=e.item,i.lottery.result.name=e.name,i.lottery.stamp=t.stamps||0,i.lottery.result.code=t.code}else dialog.show("error",t.msg,1)}),setTimeout(function(){f.lottery.startTime=+new Date,f.lottery.items[f.lottery.stateIndex].classList.add("lottery-items-select"),f.lottery.timer=requestAnimationFrame(f.lotteryLight)},1070)}},lotteryLight:function(){var t=this.lottery;if("normal"!=t.btnState){var e=+new Date;e-t.startTime>=t.aniObj.aniTime&&(t.startTime=e,t.items[t.stateIndex%8].classList.remove("lottery-items-select"),t.stateIndex++,t.items[t.stateIndex%8].classList.add("lottery-items-select"),t.aniObj.time<t.stateIndex&&(t.aniObj.aniTime=150+Math.min(150,2.1*(t.stateIndex-t.aniObj.time+1)*40),t.aniObj.stop<=t.stateIndex-40&&(t.aniObj.canplay=0,setTimeout(function(){f.user.gold-=f.user.luckyDrawCost,f.user.stamp+=t.stamp,t.result.show=1},3*t.aniObj.aniTime)))),t.aniObj.canplay&&(t.timer=requestAnimationFrame(this.lotteryLight))}}};s.prototype.init=function(){"undefined"!=this.id&&0!=this.textArry.length&&(document.querySelector("#"+this.id).innerHTML="<div class='scroll-texts-cont'><div class='text'></div></div>",this.text_dom=document.querySelector("#"+this.id+" .text"),this.start())},s.prototype.start=function(){if(this.current_index==this.textArry.length){if(!this.isLoop)return;this.current_index=0}this.text_dom.innerHTML=this.textArry[this.current_index]+"",this.text_dom.style.transform="translate3d("+this.scroll_width+"px,0,0)",this.text_dom.style.webkitTransform="translate3d("+this.scroll_width+"px,0,0)",this.text_dom.style.display="block",this.text_dom_width=this.text_dom.offsetWidth,this.current_scroll_width=this.scroll_width,requestAnimationFrame(this.timerFn.bind(this)),this.current_index++},s.prototype.timerFn=function(){this.current_scroll_width>-(this.text_dom_width+20)?(this.current_scroll_width--,this.text_dom.style.transform="translate3d("+this.current_scroll_width+"px,0,0)",this.text_dom.style.webkitTransform="translate3d("+this.current_scroll_width+"px,0,0)",requestAnimationFrame(this.timerFn.bind(this))):(this.text_dom.style.display="none",setTimeout(this.start.bind(this),this.delTime))};var g=["10MB流量","30MB流量","100MB流量"],f=new Vue({el:"#shop-root",data:h,methods:m});SDW_WEB.onShandw?SDW_WEB.getSdwUserData().then(function(t){f.user.avatar=SDW_WEB.USER_INFO.avatar||"http://www.shandw.com/pc/images/mandef.png",f.user.id=SDW_WEB.USER_INFO.id,f.user.nick=SDW_WEB.USER_INFO.nick,f.loadList()},function(){SDW_WEB.sdw.openLogin({success:function(){}})}):f.loadList()}]);